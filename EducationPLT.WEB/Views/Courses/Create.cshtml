@model EducationPLT.WEB.ViewModels.CousesVMs.CreateCourseViewModel
@{
    ViewData["Title"] = "Create Course";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-1">
                        <i class="fas fa-plus-circle text-primary me-2"></i>
                        Create New Course
                    </h2>
                    <p class="text-muted mb-0">Add a new course to the platform</p>
                </div>
                <div>
                    <a asp-action="Index" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i>
                        Back to Courses
                    </a>
                </div>
            </div>

            <!-- Form Card -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <form asp-action="Create" method="post" enctype="multipart/form-data" novalidate>
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                        <!-- Basic Information Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-info-circle text-primary me-2"></i>
                                    Basic Information
                                </h5>
                            </div>

                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label asp-for="Title" class="form-label fw-semibold">
                                        Course Title <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="Title" class="form-control" placeholder="Enter course title" />
                                    <span asp-validation-for="Title" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="Difficulty" class="form-label fw-semibold">
                                        Difficulty Level <span class="text-danger">*</span>
                                    </label>
                                    <select asp-for="Difficulty" asp-items="Model.DifficultyOptions" class="form-select">
                                        <option value="">Select Difficulty</option>
                                    </select>
                                    <span asp-validation-for="Difficulty" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="mb-3">
                                    <label asp-for="Description" class="form-label fw-semibold">
                                        Description <span class="text-danger">*</span>
                                    </label>
                                    <textarea asp-for="Description" class="form-control" rows="4"
                                              placeholder="Provide a detailed description of the course"></textarea>
                                    <span asp-validation-for="Description" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Course Details Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-cog text-primary me-2"></i>
                                    Course Details
                                </h5>
                            </div>


                            <!-- Instructor Selection (add this in the Course Details section) -->
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="InstructorId" class="form-label fw-semibold">
                                        Instructor <span class="text-danger">*</span>
                                    </label>
                                    <select asp-for="InstructorId" asp-items="Model.InstructorOptions" class="form-select">
                                        <option value="">Select Instructor</option>
                                    </select>
                                    <span asp-validation-for="InstructorId" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="CategoryId" class="form-label fw-semibold">Category</label>
                                    <select asp-for="CategoryId" asp-items="Model.CategoryOptions" class="form-select">
                                        <option value="">Select Category</option>
                                    </select>
                                    <span asp-validation-for="CategoryId" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="MaxStudents" class="form-label fw-semibold">Maximum Students</label>
                                    <input asp-for="MaxStudents" class="form-control" type="number" min="1" max="1000" />
                                    <span asp-validation-for="MaxStudents" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label asp-for="EstimatedDuration" class="form-label fw-semibold">
                                        Duration (minutes)
                                    </label>
                                    <input asp-for="EstimatedDuration" class="form-control" type="number" min="1" />
                                    <span asp-validation-for="EstimatedDuration" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Scheduling Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-calendar text-primary me-2"></i>
                                    Schedule
                                </h5>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="StartDate" class="form-label fw-semibold">Start Date</label>
                                    <input asp-for="StartDate" class="form-control" type="date" />
                                    <span asp-validation-for="StartDate" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="EndDate" class="form-label fw-semibold">End Date</label>
                                    <input asp-for="EndDate" class="form-control" type="date" />
                                    <span asp-validation-for="EndDate" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Pricing Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-dollar-sign text-primary me-2"></i>
                                    Pricing
                                </h5>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input asp-for="IsFree" class="form-check-input" type="checkbox" id="isFreeSwitch" />
                                        <label class="form-check-label fw-semibold" for="isFreeSwitch">
                                            Free Course
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6" id="priceContainer">
                                <div class="mb-3">
                                    <label asp-for="Price" class="form-label fw-semibold">Price ($)</label>
                                    <input asp-for="Price" class="form-control" type="number" step="0.01" min="0" />
                                    <span asp-validation-for="Price" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Media Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-image text-primary me-2"></i>
                                    Media Files
                                </h5>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="ThumbnailFile" class="form-label fw-semibold">Course Thumbnail</label>
                                    <input asp-for="ThumbnailFile" class="form-control" type="file" accept="image/*" />
                                    <div class="form-text">Upload an image for the course thumbnail (JPG, PNG, GIF)</div>
                                    <span asp-validation-for="ThumbnailFile" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="PreviewVideoFile" class="form-label fw-semibold">Preview Video</label>
                                    <input asp-for="PreviewVideoFile" class="form-control" type="file" accept="video/*" />
                                    <div class="form-text">Upload a preview video for the course (MP4, AVI, MOV)</div>
                                    <span asp-validation-for="PreviewVideoFile" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information Section -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="border-bottom pb-2 mb-3">
                                    <i class="fas fa-list text-primary me-2"></i>
                                    Additional Information
                                </h5>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Requirements" class="form-label fw-semibold">Prerequisites & Requirements</label>
                                    <textarea asp-for="Requirements" class="form-control" rows="5"
                                              placeholder="List any prerequisites or requirements for this course"></textarea>
                                    <span asp-validation-for="Requirements" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="LearningObjectives" class="form-label fw-semibold">Learning Objectives</label>
                                    <textarea asp-for="LearningObjectives" class="form-control" rows="5"
                                              placeholder="Describe what students will learn from this course"></textarea>
                                    <span asp-validation-for="LearningObjectives" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="row">
                            <div class="col-12">
                                <hr class="my-4">
                                <div class="d-flex justify-content-between">
                                    <a asp-action="Index" class="btn btn-outline-secondary">
                                        <i class="fas fa-times me-1"></i>
                                        Cancel
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>
                                        Create Course
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function() {
            // Handle free course toggle
            function togglePriceField() {
                var isFree = $('#isFreeSwitch').is(':checked');
                var priceContainer = $('#priceContainer');
                var priceInput = $('input[name="Price"]');

                if (isFree) {
                    priceContainer.hide();
                    priceInput.val('0');
                } else {
                    priceContainer.show();
                    if (priceInput.val() === '0') {
                        priceInput.val('');
                    }
                }
            }

            // Initialize price field visibility
            togglePriceField();

            // Handle checkbox change
            $('#isFreeSwitch').change(function() {
                togglePriceField();
            });

            // Form validation enhancement
            $('form').submit(function(e) {
                var isValid = true;
                var errors = [];

                // Custom validation
                if (!$('input[name="Title"]').val().trim()) {
                    errors.push('Course title is required');
                    isValid = false;
                }

                if (!$('select[name="Difficulty"]').val()) {
                    errors.push('Difficulty level is required');
                    isValid = false;
                }

                if (!$('textarea[name="Description"]').val().trim()) {
                    errors.push('Course description is required');
                    isValid = false;
                }

                if (!$('#isFreeSwitch').is(':checked') && !$('input[name="Price"]').val()) {
                    errors.push('Price is required for paid courses');
                    isValid = false;
                }

                if (!isValid) {
                    e.preventDefault();
                    alert('Please fix the following errors:\n' + errors.join('\n'));
                }
            });
        });
    </script>
}
